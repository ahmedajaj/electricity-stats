# âš¡ Electricity Statistics Tracker

Automated scraper that collects electricity status from Telegram channel [@lvivskiy7a](https://t.me/lvivskiy7a) and uploads to [GitHub Gist](https://gist.github.com/ahmedajaj/f73208e345aee68d11c31c4d1f8c32f7) every 10 minutes. Web UI shows statistics for **ĞšĞ¸Ñ—Ğ², Ğ¡Ğ¾Ñ„Ñ–Ñ— Ğ ÑƒÑĞ¾Ğ²Ğ¾Ñ— 7Ğ**.

**Data format:**
```json
[
  {
    "date": "2025-10-10T00:34:59.000Z",
    "status": "off"
  },
  {
    "date": "2025-10-10T15:36:52.000Z",
    "status": "on"
  },
  {
    "date": "2025-10-22T09:05:48.000Z",
    "status": "off"
  }
]
```

---

## ğŸš€ Setup

```bash
# Install
npm install

# Configure (copy data/.env.example to data/.env)
TELEGRAM_API_ID=your_id
TELEGRAM_API_HASH=your_hash
TELEGRAM_PHONE=+380...
GITHUB_TOKEN=ghp_...
GIST_ID=autogenerated

# First run (creates data/session.json)
npm run scrape

# Setup cron (runs every 10 minutes)
./setup-cron.sh

# Start web server
npm start
```

Visit **http://localhost:3000**

---

## ğŸ“ Structure

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js          # Express API
â”‚   â”œâ”€â”€ scraper.js         # Telegram scraper
â”‚   â”œâ”€â”€ dataStore.js       # Statistics
â”‚   â”œâ”€â”€ gist-uploader.js   # GitHub Gist API
â”‚   â””â”€â”€ gist-runner.js     # Cron script
â”œâ”€â”€ public/                # Web UI
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ .env              # Config
â”‚   â”œâ”€â”€ session.json      # Telegram session
â”‚   â””â”€â”€ events.json       # Data cache
â””â”€â”€ setup-cron.sh         # Cron installer
```

---

## ğŸ”Œ Commands

```bash
npm start            # Start web server
npm run scrape       # Manual scrape
npm run gist:upload  # Manual upload to Gist
npm run gist:run     # Run scraper + upload (used by cron)
```

---

## ğŸŒ API

- `GET /api/events` - All events
- `GET /api/statistics` - Statistics summary
- `GET /api/statistics/daily` - Daily breakdown

---

## ğŸ”„ How It Works

1. **Cron** runs `gist-runner.js` every 10 minutes
2. **Scraper** fetches messages from @lvivskiy7a
3. **Gist Uploader** checks for changes (SHA-256 hash)
4. If changed, uploads to GitHub Gist
5. **Web UI** fetches data from Gist and displays stats

**Data source:** Telegram â†’ **Storage:** GitHub Gist â†’ **UI:** Express + Chart.js

---

## ğŸ”Œ VM installation steps

```bash
apt update -y
apt upgrade -y
apt install git nodejs npm -y
git clone https://github.com/ahmedajaj/electricity-stats.git
npm i
npm install pm2@latest -g
pm2 start ecosystem.config.js
```
